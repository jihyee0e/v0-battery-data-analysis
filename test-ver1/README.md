# 🔋 전기차 배터리 데이터 분석 및 시각화 시스템 (PostgreSQL ver.)

## 📋 프로젝트 개요

**프로젝트명:** AICAR - 전기차 배터리 데이터 분석 및 시각화 대시보드

**개발 기간**: 2025년 9월 ~ 10월
**개발 환경 및 언어**: Next.js, React, TypeScript, CSS, PostgreSQL, Docker, Python

**배경:**
- 기존 CSV 형태의 대량 배터리 데이터를 체계적으로 관리하고 분석할 수 있는 시스템 필요
- 차종별로 다른 데이터 구조를 통합하여 일관된 분석 환경 구축 필요
- ERD 설계를 위한 데이터 특성 분석 및 데이터베이스 스키마 설계 선행 필요
- 오프라인 배치 처리 방식으로 대용량 데이터를 효율적으로 처리하고 저장

**목표:**
- CSV 원천 데이터를 PostgreSQL로 전처리 및 저장하는 배치 처리 파이프라인 구축
- 차종별 테이블 분리 구조를 통한 효율적인 데이터 관리 및 쿼리 성능 최적화
- 머티리얼라이즈드 뷰를 활용한 대시보드 통계 데이터 사전 계산 및 빠른 조회
- Python 기반 오프라인 분석 스크립트를 통한 데이터 품질 검증 및 ERD 설계 근거 마련
- 차량별 성능 등급 분류 및 랭킹 시스템을 통한 비교 분석 기능 제공

## 📊 데이터

### 데이터 소스
- **PostgreSQL 관계형 데이터베이스**: 전기차 배터리 관리 시스템(BMS) 및 GPS 데이터
- **측정 항목**: SOC, SOH, 팩 전압/전류, 모듈 온도, 주행 거리, GPS 위치 정보 등
- **차량 유형**: PORTER2, GV60, BONGO3 등 다양한 전기차 모델

### 데이터 처리 파이프라인
- **1단계: 데이터 분석**: CSV 파일의 컬럼 구조, 데이터 타입, 결측치, 통계 정보 등을 분석하고 ERD 설계 근거 마련
- **2단계: 데이터 전처리**: 데이터 정제, 컬럼 추가/제거, 형식 변환 등 전처리 수행
- **3단계: 데이터베이스 저장**: 전처리된 CSV 데이터를 차종별 테이블(bongo3_bms_data, gv60_bms_data, porter2_bms_data 등)에 배치 로드
- **4단계: 인덱스 및 뷰 생성**: 쿼리 성능 최적화 및 머티리얼라이즈드 뷰 생성
- **5단계: API 조회**: Next.js API를 통해 저장된 데이터를 조회하고 대시보드에 시각화


## 🔧 주요 기능

### 📊 실시간 대시보드
전체 차량 현황을 한눈에 파악할 수 있는 통합 대시보드

**주요 기능:**
- 📈 **데이터 통계**: 전체 차량 수, 온라인 차량 비율(5분 이내), 평균 SOC/SOH
- 🔋 **배터리 상태**: 실시간 SOC 모니터링 및 배터리 게이지 표시
- ⚡ **충전 정보**: 현재 충전 중인 차량 수, 충전 상태 표시
- 🚗 **이동 상태**: 현재 이동 중인 차량 수 표시
- 🌡️ **온도 모니터링**: 고온 차량 비율 표시
- ⚖️ **셀 밸런스**: 셀 전압 불균형 차량 비율
- 💚 **배터리 건강도**: SOH 기반 저건강도 차량 비율
- 📋 **차종별 통계**: PORTER2, GV60, BONGO3 등 차종별 상세 통계
  - 차종별 등록 차량 수
  - 차종별 평균 SOC/SOH
  - 차종별 온라인 비율
  - 차종별 충전/이동 상태
- 🔄 **날짜 범위 필터**: 전체 기간 또는 특정 기간 선택 가능
- 📊 **차종 선택**: 특정 차종의 데이터만 필터링하여 확인

### 🚗 차량 성능 페이지
차량별 상세 정보 및 성능 모니터링 페이지

**주요 기능:**
- 📋 **차량 목록**: 차량 ID별 상세 정보 표시
- 🔍 **필터링 기능**:
  - 차종 필터 (PORTER2, GV60, BONGO3)
  - 등급 필터 (우수, 양호, 보통, 불량)
  - 상태 필터 (충전중, 주행중, 대기중)
  - 품질 필터 (높음, 보통, 낮음)
- 📊 **정렬 기능**: SOH, 효율성, 충전효율, 최신순 정렬
- 📈 **성능 지표**: 각 차량의 주요 성능 지표 표시
  - SOC/SOH: 배터리 충전 상태 및 건강도
  - 효율성: 평균 효율성 지표
  - 온도: 모듈 평균 온도
  - 전압/전류/전력: 전기적 특성
- 🏷️ **상태 표시**: 성능 등급, 차량 상태 배지 표시
- 📍 **위치 정보**: GPS 기반 위치 및 속도 정보
- 📄 **페이지네이션**: 대량 데이터 효율적 탐색

### 📊 차량 상세 분석
특정 차량의 구간별 통계 및 주행 패턴 분석 페이지

**주요 기능:**
- 🆔 **차량 선택**: 차량 ID 선택을 통한 개별 차량 분석
- 📊 **기본 정보 카드**:
  - 배터리 상태 (SOC, SOH)
  - 전기적 특성 (전압, 전류, 전력)
  - 온도 정보
  - 위치 정보 (GPS 좌표, 속도)
- 📈 **시계열 차트**: 시간별 배터리 성능 추이 시각화
  - SOC/SOH 변화 추이
  - 팩 전압/전류 변화
  - 모듈 온도 변화
- 📋 **히스토리 데이터**: 날짜별 평균 데이터 및 기록 수
- 📊 **데이터 품질**: 데이터 품질 등급 표시
- 🔄 **업데이트 시간**: 마지막 업데이트 시간 및 경과 시간 표시

### 🏆 랭킹 페이지
차량 성능 기반 랭킹 및 비교 분석 페이지

**주요 기능:**
- 🏅 **랭킹 기준 선택**:
  - 종합 성능: 전체 지표를 종합한 점수
  - SOH: 배터리 건강도 기준
  - 효율성: 주행 효율 기준
- 🔍 **필터링**: 차종별 필터링
- 📊 **상위 N위 선택**: 상위 10위, 20위, 50위, 100위 선택 가능
- 🏆 **랭킹 표시**: 순위별 아이콘 표시 (1위: 트로피, 2위: 메달, 3위: 상장)
- 📈 **성능 지표**: 각 차량의 SOH, 효율성, SOC, 종합 점수 표시
- 🏷️ **등급 표시**: 종합 점수 기반 등급 표시 (우수, 양호, 보통, 불량)
- 📊 **카테고리 분류**: TOP_10, HIGH_PERFORMANCE, AVERAGE, LOW_PERFORMANCE
- 📊 **통계 요약**: 카테고리별 차량 수 통계

### 🔬 데이터 분석 페이지
종합적인 데이터 분석 및 시각화 대시보드

**주요 기능:**
- 🔍 **필터링**: 차종 선택, 기간 선택 (7일, 30일, 90일)
- 📑 **탭 기반 분석**:
  - **셀 밸런스 분석**: 셀 간 전압 불균형 패턴 분석 및 트리거 탐지
  - **주행 패턴 분석**: 운전 효율성 및 에너지 소비 패턴 분석
  - **이상 탐지**: 통계적 방법론 기반 배터리 이상 패턴 감지 및 위험도 분류
  - **성능 트렌드**: 시간에 따른 배터리 성능 변화 추이 분석
- 📊 **시각화**: 각 분석 항목별 인터랙티브 차트 및 그래프
- 📈 **트렌드 분석**: 다양한 지표의 시간별 변화 추이

## 🔄 개발 워크플로우

### 데이터 수집 및 분석 단계
1. **CSV 원천 데이터 준비**: 차종별로 분리된 BMS/GPS CSV 파일 준비
2. **데이터 특성 분석**:
   - 파일 크기, 컬럼 수, 데이터 타입 분석
   - 결측치, 통계 정보 (평균, 최소, 최대, 표준편차) 계산
3. **ERD 설계**: 분석 결과를 바탕으로 데이터베이스 스키마 설계

### 데이터 전처리 단계
1. **기본 전처리**: 
   - 데이터 형식 변환, 결측치 처리
   - 컬럼명 정규화 및 데이터 타입 통일
2. **컬럼 관리**: 필요에 따라 컬럼 추가/제거

### 데이터베이스 구축 단계
1. **테이블 생성**: 
   - 차종별 BMS/GPS 테이블 생성 (bongo3_bms_data, gv60_bms_data, porter2_bms_data 등)
   - 각 차종별로 다른 컬럼 구조 반영 (예: BONGO3는 192개 셀 전압)
2. **데이터 로드**: 
   - 전처리된 CSV 파일 배치 로드
   - 차종별 테이블에 해당 데이터 저장
3. **인덱스 생성**: 
   - device_no, car_type, msg_ts 등 자주 조회되는 컬럼에 인덱스 생성
   - 쿼리 성능 최적화

### 분석 뷰 및 통계 생성 단계
1. **분석 데이터베이스 구축**: 
   - 머티리얼라이즈드 뷰 생성
   - 차종별 테이블을 UNION ALL로 통합하여 통계 계산
   - 온라인 차량, 충전/이동 상태, 셀 밸런스 지수 등 집계
2. **고급 분석**:
   - 추가 분석 뷰 및 함수 생성

### API 및 대시보드 개발 단계
1. **API 개발**: Next.js API Routes에서 PostgreSQL 쿼리 실행
   - 머티리얼라이즈드 뷰를 활용한 빠른 통계 조회
   - 차종별 필터링 및 페이지네이션 지원
2. **대시보드 시각화**: React 컴포넌트로 데이터 시각화
   - Recharts를 활용한 인터랙티브 차트
   - 실시간 데이터 조회 (저장된 데이터 기준)

## 📊 성능 최적화

### 데이터베이스 최적화
- **차종별 테이블 분리**: 차종별로 독립된 테이블로 분리하여 쿼리 범위 축소 및 인덱스 효율성 향상
- **인덱싱 전략**: device_no, car_type, msg_ts 등 자주 조회되는 컬럼에 복합 인덱스 생성
- **머티리얼라이즈드 뷰**: 대시보드 통계를 사전 계산하여 저장함으로써 UNION ALL 연산 비용 절감
- **배치 로드**: COPY 명령어를 사용한 대량 데이터 배치 로드로 INSERT 성능 향상